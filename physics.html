<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhysLab ‚Äî Symulator Mechaniki</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{
  --p:#6366f1;--pd:#4f46e5;--sec:#ec4899;--acc:#10b981;
  --dark:#1f2937;--darker:#07050f;--border:#e5e7eb;
  --grad:linear-gradient(135deg,#6366f1 0%,#ec4899 100%);
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{width:100%;height:100%;overflow:hidden;}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--darker);color:#e5e7eb;display:flex;flex-direction:column;}

#hdr{background:rgba(7,5,15,.97);backdrop-filter:blur(20px);border-bottom:1px solid rgba(99,102,241,.2);height:52px;display:flex;align-items:center;padding:0 20px;gap:12px;flex-shrink:0;}
#logo{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:900;font-style:italic;background:var(--grad);-webkit-background-clip:text;background-clip:text;color:transparent;letter-spacing:-.02em;}
.badge{display:flex;align-items:center;gap:5px;padding:3px 11px;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.25);border-radius:999px;font-size:.62rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:#34d399;}
.badge::before{content:'';width:6px;height:6px;border-radius:50%;background:#34d399;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1);}50%{opacity:.4;transform:scale(1.4);}}
.sp{flex:1;}

#tabs{height:44px;background:rgba(7,5,15,.95);border-bottom:1px solid rgba(99,102,241,.13);display:flex;align-items:stretch;padding:0 12px;gap:1px;flex-shrink:0;overflow-x:auto;}
#tabs::-webkit-scrollbar{height:0;}
.tb{display:flex;align-items:center;gap:6px;padding:0 14px;border:none;background:none;color:rgba(255,255,255,.3);font-family:'Plus Jakarta Sans',sans-serif;font-size:.76rem;font-weight:700;cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;transition:all .15s;}
.tb .tn{font-family:'JetBrains Mono',monospace;font-size:.58rem;background:rgba(255,255,255,.06);color:rgba(255,255,255,.2);padding:1px 5px;border-radius:3px;}
.tb:hover{color:rgba(255,255,255,.65);}
.tb.active{color:#fff;border-bottom-color:var(--p);}
.tb.active .tn{background:rgba(99,102,241,.2);color:var(--p);}

#main{flex:1;overflow:hidden;display:flex;flex-direction:column;}
.sc{display:none;flex:1;overflow:hidden;flex-direction:column;}
.sc.active{display:flex;}

.rb{background:rgba(255,255,255,.025);border-bottom:1px solid rgba(255,255,255,.06);display:flex;flex-wrap:wrap;flex-shrink:0;}
.ri{display:flex;align-items:center;gap:8px;padding:6px 14px;border-right:1px solid rgba(255,255,255,.05);min-width:95px;}
.rd{width:6px;height:6px;border-radius:50%;flex-shrink:0;}
.rl{font-size:.58rem;font-weight:700;letter-spacing:.07em;text-transform:uppercase;color:rgba(255,255,255,.22);}
.rv{font-family:'JetBrains Mono',monospace;font-size:.8rem;font-weight:500;margin-top:1px;}

.sa{flex:1;position:relative;overflow:hidden;background:linear-gradient(rgba(99,102,241,.05) 1px,transparent 1px),linear-gradient(90deg,rgba(99,102,241,.05) 1px,transparent 1px),linear-gradient(rgba(99,102,241,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(99,102,241,.015) 1px,transparent 1px),radial-gradient(ellipse 80% 60% at 50% 0%,rgba(30,10,60,.6) 0%,#07050f 70%);background-size:80px 80px,80px 80px,16px 16px,16px 16px,100% 100%;}
canvas{position:absolute;top:0;left:0;width:100%;height:100%;}

.sbdg{position:absolute;top:10px;left:50%;transform:translateX(-50%);padding:4px 13px;border-radius:999px;font-size:.66rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;pointer-events:none;z-index:10;backdrop-filter:blur(6px);}
.sgreen{background:rgba(16,185,129,.12);color:#34d399;border:1.5px solid rgba(16,185,129,.28);}
.samber{background:rgba(245,158,11,.12);color:#fbbf24;border:1.5px solid rgba(245,158,11,.28);}
.sblue{background:rgba(99,102,241,.12);color:#a78bfa;border:1.5px solid rgba(99,102,241,.28);}
.sred{background:rgba(220,38,38,.12);color:#f87171;border:1.5px solid rgba(220,38,38,.28);}

.cp{background:#fff;border-top:1px solid var(--border);padding:9px 18px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;flex-shrink:0;box-shadow:0 -4px 20px rgba(0,0,0,.07);}
.cl{font-size:.64rem;font-weight:800;letter-spacing:.08em;text-transform:uppercase;color:#6b7280;}

.btn{display:flex;align-items:center;gap:5px;padding:7px 13px;border-radius:8px;border:1.5px solid var(--border);background:#fff;color:var(--dark);font-family:'Plus Jakarta Sans',sans-serif;font-size:.78rem;font-weight:700;cursor:pointer;transition:all .17s;}
.btn:hover{border-color:var(--p);color:var(--p);transform:translateY(-1px);box-shadow:0 3px 10px rgba(99,102,241,.13);}
.btn.pr{background:var(--grad);border-color:transparent;color:#fff;box-shadow:0 4px 14px rgba(99,102,241,.4);}
.btn.pr:hover{box-shadow:0 6px 22px rgba(99,102,241,.55);transform:translateY(-1px);}
.btn.dn{background:rgba(220,38,38,.07);color:#dc2626;border-color:rgba(220,38,38,.2);}
.btn.dn:hover{background:rgba(220,38,38,.13);border-color:#dc2626;}
.btn.sm{padding:4px 9px;font-size:.7rem;}

.sw{display:flex;flex-direction:column;gap:3px;min-width:130px;}
.st{display:flex;align-items:center;justify-content:space-between;gap:5px;}
.sv{font-family:'JetBrains Mono',monospace;font-size:.74rem;color:var(--p);min-width:52px;text-align:right;font-weight:600;}
input[type=range]{-webkit-appearance:none;width:100%;height:4px;border-radius:2px;background:linear-gradient(to right,var(--p) 0%,var(--p) var(--pct,50%),#e5e7eb var(--pct,50%));outline:none;cursor:pointer;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:15px;height:15px;border-radius:50%;background:var(--grad);border:2px solid #fff;cursor:pointer;box-shadow:0 2px 7px rgba(99,102,241,.4);}

.tw{display:flex;align-items:center;gap:7px;}
.tg{position:relative;width:34px;height:19px;flex-shrink:0;}
.tg input{opacity:0;width:0;height:0;}
.tgr{position:absolute;inset:0;border-radius:9px;cursor:pointer;transition:background .2s;background:#e5e7eb;border:1.5px solid var(--border);}
.tg input:checked+.tgr{background:var(--grad);border-color:var(--p);}
.tgth{position:absolute;top:2px;left:2px;width:13px;height:13px;background:#fff;border-radius:50%;transition:transform .2s;box-shadow:0 1px 4px rgba(0,0,0,.2);}
.tg input:checked~.tgth{transform:translateX(15px);}
.tgl{font-size:.72rem;color:#6b7280;font-weight:600;}

.pgb{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 10px;border-radius:8px;border:1.5px solid var(--border);background:#fff;cursor:pointer;transition:all .17s;min-width:60px;}
.pgb:hover{border-color:var(--p);transform:translateY(-1px);}
.pgb.active{border-color:var(--p);background:rgba(99,102,241,.06);}
.pgi{font-size:1.1rem;line-height:1;}
.pgn{font-size:.62rem;color:#6b7280;font-weight:700;}
.pgm{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--p);}
.pgr{display:flex;gap:5px;flex-wrap:wrap;}

.vdiv{width:1px;height:30px;background:var(--border);flex-shrink:0;}

@media(max-width:680px){.tb{padding:0 8px;font-size:.7rem;}.cp{padding:7px 10px;gap:8px;}.ri{min-width:80px;}}
</style>
</head>
<body>

<div id="hdr">
  <div id="logo">PhysLab</div>
  <span style="font-size:.65rem;font-weight:600;color:rgba(255,255,255,.3);letter-spacing:.08em;text-transform:uppercase;">SYMULATOR MECHANIKI</span>
  <div class="sp"></div>
  <div class="badge">Live Physics</div>
  <a href="index.html" class="btn sm" title="Powr√≥t do strony g≈Ç√≥wnej" style="margin-left:8px;text-decoration:none;">‚Üê Strona g≈Ç√≥wna</a>
</div>

<div id="tabs">
  <button class="tb active" onclick="showTab(0)"><span class="tn">01</span>PrzeciƒÖganie</button>
  <button class="tb" onclick="showTab(1)"><span class="tn">02</span>Ruch i Si≈Çy</button>
  <button class="tb" onclick="showTab(2)"><span class="tn">03</span>Tarcie</button>
  <button class="tb" onclick="showTab(3)"><span class="tn">04</span>a = F/m</button>
  <button class="tb" onclick="showTab(4)"><span class="tn">05</span>Wahad≈Ço</button>
  <button class="tb" onclick="showTab(5)"><span class="tn">06</span>Sprƒô≈ºyna</button>
  <button class="tb" onclick="showTab(6)"><span class="tn">07</span>Kolizje</button>
  <button class="tb" onclick="showTab(7)"><span class="tn">08</span>Rzut uko≈õny</button>
</div>

<div id="main">

<!-- S1: TUG -->
<div class="sc active" id="s1">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#f87171"></div><div><div class="rl">Si≈Ça ‚Üê</div><div class="rv" id="r1fl" style="color:#f87171">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#60a5fa"></div><div><div class="rl">Si≈Ça ‚Üí</div><div class="rv" id="r1fr" style="color:#60a5fa">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Wypadkowa</div><div class="rv" id="r1fn" style="color:#a78bfa">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Prƒôdko≈õƒá</div><div class="rv" id="r1v" style="color:#34d399">0.00 m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Przyspieszenie</div><div class="rv" id="r1a" style="color:#fbbf24">0.000 m/s¬≤</div></div></div>
  </div>
  <div class="sa" id="w1"><canvas id="c1"></canvas><div class="sbdg sgreen" id="b1">R√ìWNOWAGA</div></div>
  <div class="cp">
    <div style="display:flex;align-items:center;gap:7px">
      <span class="cl" style="color:#f87171">LEWA</span>
      <button class="btn sm dn" onclick="T1.add(-1)">Ôºã si≈Çƒô</button>
      <button class="btn sm" onclick="T1.rem(-1)">Ôºç</button>
      <span style="font-family:'JetBrains Mono';font-size:.76rem;color:#f87171;font-weight:700" id="l1lc">√ó0</span>
    </div>
    <div class="vdiv"></div>
    <div style="display:flex;align-items:center;gap:7px">
      <span class="cl" style="color:#60a5fa">PRAWA</span>
      <button class="btn sm" onclick="T1.add(1)">Ôºã si≈Çƒô</button>
      <button class="btn sm dn" onclick="T1.rem(1)">Ôºç</button>
      <span style="font-family:'JetBrains Mono';font-size:.76rem;color:#60a5fa;font-weight:700" id="l1rc">√ó0</span>
    </div>
    <div class="vdiv"></div>
    <label class="tw"><div class="tg"><input type="checkbox" id="t1sv" checked><div class="tgr"></div><div class="tgth"></div></div><span class="tgl">Warto≈õci</span></label>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b1pp" onclick="T1.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="T1.reset()">‚Ü∫ Reset</button>
    </div>
    <div class="sw" style="min-width:150px"><div class="st"><span class="cl">Masa w√≥zka</span><span class="sv" id="l1m">20 kg</span></div><input type="range" id="sl1m" min="5" max="100" value="20" step="5" oninput="T1.setM(this.value);UF(this)"></div>
  </div>
</div>

<!-- S2: MOTION -->
<div class="sc" id="s2">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Si≈Ça</div><div class="rv" id="r2f" style="color:#a78bfa">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Prƒôdko≈õƒá</div><div class="rv" id="r2v" style="color:#34d399">0.00 m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Przyspieszenie</div><div class="rv" id="r2a" style="color:#fbbf24">0.000 m/s¬≤</div></div></div>
    <div class="ri"><div class="rd" style="background:#f472b6"></div><div><div class="rl">Droga</div><div class="rv" id="r2x" style="color:#f472b6">0.00 m</div></div></div>
    <div class="ri"><div class="rd" style="background:#22d3ee"></div><div><div class="rl">Czas</div><div class="rv" id="r2t" style="color:#22d3ee">0.00 s</div></div></div>
  </div>
  <div class="sa" id="w2"><canvas id="c2"></canvas></div>
  <div class="cp">
    <div class="sw" style="min-width:185px"><div class="st"><span class="cl">Si≈Ça przy≈Ço≈ºona [N]</span><span class="sv" id="l2f">0 N</span></div><input type="range" id="sl2f" min="-300" max="300" value="0" step="10" oninput="M2.setF(this.value);UF(this)"></div>
    <div class="vdiv"></div>
    <span class="cl">Obiekt</span><div class="pgr" id="pr2"></div>
    <label class="tw"><div class="tg"><input type="checkbox" id="t2tr" checked><div class="tgr"></div><div class="tgth"></div></div><span class="tgl">≈ölad</span></label>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b2pp" onclick="M2.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="M2.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

<!-- S3: FRICTION -->
<div class="sc" id="s3">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Si≈Ça</div><div class="rv" id="r3f" style="color:#a78bfa">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#f87171"></div><div><div class="rl">Tarcie</div><div class="rv" id="r3ff" style="color:#f87171">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Wypadkowa</div><div class="rv" id="r3fn" style="color:#fbbf24">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Prƒôdko≈õƒá</div><div class="rv" id="r3v" style="color:#34d399">0.00 m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#86efac"></div><div><div class="rl">Œº tarcia</div><div class="rv" id="r3mu" style="color:#86efac">0.30</div></div></div>
  </div>
  <div class="sa" id="w3"><canvas id="c3"></canvas><div class="sbdg sblue" id="b3" style="top:36px">STATYKA</div></div>
  <div class="cp">
    <div class="sw" style="min-width:155px"><div class="st"><span class="cl">Si≈Ça [N]</span><span class="sv" id="l3f">0 N</span></div><input type="range" id="sl3f" min="0" max="400" value="0" step="5" oninput="M3.setF(this.value);UF(this)"></div>
    <div class="sw" style="min-width:140px"><div class="st"><span class="cl">Œº tarcia</span><span class="sv" id="l3mu">0.30</span></div><input type="range" id="sl3mu" min="0" max="1.5" value="0.3" step="0.05" oninput="M3.setMu(this.value);UF(this)"></div>
    <span class="cl">Obiekt</span><div class="pgr" id="pr3"></div>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b3pp" onclick="M3.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="M3.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

<!-- S4: ACCELERATION -->
<div class="sc" id="s4">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Si≈Ça</div><div class="rv" id="r4f" style="color:#a78bfa">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#f87171"></div><div><div class="rl">Tarcie</div><div class="rv" id="r4ff" style="color:#f87171">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Wypadkowa</div><div class="rv" id="r4fn" style="color:#fbbf24">0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#86efac"></div><div><div class="rl">Przyspieszenie</div><div class="rv" id="r4a" style="color:#86efac">0.000 m/s¬≤</div></div></div>
    <div class="ri"><div class="rd" style="background:#22d3ee"></div><div><div class="rl">Masa</div><div class="rv" id="r4m" style="color:#22d3ee">20 kg</div></div></div>
  </div>
  <div class="sa" id="w4"><canvas id="c4"></canvas></div>
  <div class="cp">
    <div class="sw" style="min-width:155px"><div class="st"><span class="cl">Si≈Ça [N]</span><span class="sv" id="l4f">0 N</span></div><input type="range" id="sl4f" min="0" max="500" value="0" step="10" oninput="M4.setF(this.value);UF(this)"></div>
    <div class="sw" style="min-width:130px"><div class="st"><span class="cl">Masa [kg]</span><span class="sv" id="l4m">20 kg</span></div><input type="range" id="sl4m" min="1" max="100" value="20" step="1" oninput="M4.setM(this.value);UF(this)"></div>
    <div class="sw" style="min-width:125px"><div class="st"><span class="cl">Œº tarcia</span><span class="sv" id="l4mu">0.00</span></div><input type="range" id="sl4mu" min="0" max="1.5" value="0" step="0.05" oninput="M4.setMu(this.value);UF(this)"></div>
    <label class="tw"><div class="tg"><input type="checkbox" id="t4sf" checked><div class="tgr"></div><div class="tgth"></div></div><span class="tgl">F=m¬∑a</span></label>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b4pp" onclick="M4.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="M4.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

<!-- S5: PENDULUM -->
<div class="sc" id="s5">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#f472b6"></div><div><div class="rl">KƒÖt Œ∏</div><div class="rv" id="r5ang" style="color:#f472b6">0.0¬∞</div></div></div>
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Prƒôdko≈õƒá kƒÖt.</div><div class="rv" id="r5om" style="color:#34d399">0.000 rad/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Okres T</div><div class="rv" id="r5per" style="color:#fbbf24">‚Äî s</div></div></div>
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Energia</div><div class="rv" id="r5en" style="color:#a78bfa">0.000 J</div></div></div>
    <div class="ri"><div class="rd" style="background:#22d3ee"></div><div><div class="rl">T_liniowe</div><div class="rv" id="r5tlin" style="color:#22d3ee">‚Äî s</div></div></div>
  </div>
  <div class="sa" id="w5"><canvas id="c5"></canvas><div class="sbdg sblue" id="b5">WAHAD≈ÅO MATEMATYCZNE</div></div>
  <div class="cp">
    <div class="sw" style="min-width:145px"><div class="st"><span class="cl">D≈Çugo≈õƒá L [m]</span><span class="sv" id="l5L">1.00 m</span></div><input type="range" id="sl5L" min="0.2" max="3" value="1" step="0.05" oninput="P5.setL(this.value);UF(this)"></div>
    <div class="sw" style="min-width:138px"><div class="st"><span class="cl">KƒÖt startowy</span><span class="sv" id="l5a">30¬∞</span></div><input type="range" id="sl5a" min="5" max="175" value="30" step="1" oninput="P5.setA(this.value);UF(this)"></div>
    <div class="sw" style="min-width:128px"><div class="st"><span class="cl">T≈Çumienie</span><span class="sv" id="l5d">0.00</span></div><input type="range" id="sl5d" min="0" max="0.6" value="0" step="0.01" oninput="P5.setD(this.value);UF(this)"></div>
    <div class="sw" style="min-width:128px"><div class="st"><span class="cl">Grawitacja</span><span class="sv" id="l5g">9.81 m/s¬≤</span></div><input type="range" id="sl5g" min="1" max="25" value="9.81" step="0.1" oninput="P5.setG(this.value);UF(this)"></div>
    <label class="tw"><div class="tg"><input type="checkbox" id="t5ph" checked><div class="tgr"></div><div class="tgth"></div></div><span class="tgl">Portret fazowy</span></label>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b5pp" onclick="P5.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="P5.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

<!-- S6: SPRING -->
<div class="sc" id="s6">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Wychylenie x</div><div class="rv" id="r6x" style="color:#34d399">0.000 m</div></div></div>
    <div class="ri"><div class="rd" style="background:#f87171"></div><div><div class="rl">Si≈Ça sprƒô≈ºyny</div><div class="rv" id="r6f" style="color:#f87171">0.0 N</div></div></div>
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Ep potencj.</div><div class="rv" id="r6ep" style="color:#a78bfa">0.000 J</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Ek kinetyczna</div><div class="rv" id="r6ek" style="color:#fbbf24">0.000 J</div></div></div>
    <div class="ri"><div class="rd" style="background:#22d3ee"></div><div><div class="rl">Okres T</div><div class="rv" id="r6per" style="color:#22d3ee">‚Äî s</div></div></div>
  </div>
  <div class="sa" id="w6"><canvas id="c6"></canvas><div class="sbdg sgreen" id="b6">PRAWO HOOKE'A: F = ‚àíkx</div></div>
  <div class="cp">
    <div class="sw" style="min-width:150px"><div class="st"><span class="cl">Sztywno≈õƒá k [N/m]</span><span class="sv" id="l6k">20 N/m</span></div><input type="range" id="sl6k" min="1" max="200" value="20" step="1" oninput="SP6.setK(this.value);UF(this)"></div>
    <div class="sw" style="min-width:132px"><div class="st"><span class="cl">Masa [kg]</span><span class="sv" id="l6m">1.0 kg</span></div><input type="range" id="sl6m" min="0.1" max="10" value="1" step="0.1" oninput="SP6.setM(this.value);UF(this)"></div>
    <div class="sw" style="min-width:140px"><div class="st"><span class="cl">Wychylenie x‚ÇÄ</span><span class="sv" id="l6x">0.50 m</span></div><input type="range" id="sl6x" min="0.05" max="1.5" value="0.5" step="0.05" oninput="SP6.setX0(this.value);UF(this)"></div>
    <div class="sw" style="min-width:122px"><div class="st"><span class="cl">T≈Çumienie Œ≥</span><span class="sv" id="l6d">0.00</span></div><input type="range" id="sl6d" min="0" max="2" value="0" step="0.05" oninput="SP6.setD(this.value);UF(this)"></div>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b6pp" onclick="SP6.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="SP6.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

<!-- S7: COLLISIONS -->
<div class="sc" id="s7">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#f87171"></div><div><div class="rl">p‚ÇÅ = m‚ÇÅv‚ÇÅ</div><div class="rv" id="r7p1" style="color:#f87171">10 kg¬∑m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#60a5fa"></div><div><div class="rl">p‚ÇÇ = m‚ÇÇv‚ÇÇ</div><div class="rv" id="r7p2" style="color:#60a5fa">-6 kg¬∑m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Œ£p (zach.)</div><div class="rv" id="r7pt" style="color:#a78bfa">4 kg¬∑m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Ek ca≈Çkowita</div><div class="rv" id="r7ek" style="color:#fbbf24">0 J</div></div></div>
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Typ zderzenia</div><div class="rv" id="r7ty" style="color:#34d399">ELASTYCZNE</div></div></div>
  </div>
  <div class="sa" id="w7"><canvas id="c7"></canvas><div class="sbdg samber" id="b7">ZASADA ZACHOWANIA PƒòDU</div></div>
  <div class="cp">
    <div style="display:flex;flex-direction:column;gap:3px">
      <span class="cl" style="color:#f87171">KULA 1</span>
      <div style="display:flex;gap:7px">
        <div class="sw" style="min-width:105px"><div class="st"><span class="cl">m‚ÇÅ [kg]</span><span class="sv" id="l7m1">2 kg</span></div><input type="range" id="sl7m1" min="0.5" max="10" value="2" step="0.5" oninput="CL7.setM1(this.value);UF(this)"></div>
        <div class="sw" style="min-width:105px"><div class="st"><span class="cl">v‚ÇÅ [m/s]</span><span class="sv" id="l7v1">5 m/s</span></div><input type="range" id="sl7v1" min="-15" max="15" value="5" step="0.5" oninput="CL7.setV1(this.value);UF(this)"></div>
      </div>
    </div>
    <div class="vdiv"></div>
    <div style="display:flex;flex-direction:column;gap:3px">
      <span class="cl" style="color:#60a5fa">KULA 2</span>
      <div style="display:flex;gap:7px">
        <div class="sw" style="min-width:105px"><div class="st"><span class="cl">m‚ÇÇ [kg]</span><span class="sv" id="l7m2">2 kg</span></div><input type="range" id="sl7m2" min="0.5" max="10" value="2" step="0.5" oninput="CL7.setM2(this.value);UF(this)"></div>
        <div class="sw" style="min-width:105px"><div class="st"><span class="cl">v‚ÇÇ [m/s]</span><span class="sv" id="l7v2">-3 m/s</span></div><input type="range" id="sl7v2" min="-15" max="15" value="-3" step="0.5" oninput="CL7.setV2(this.value);UF(this)"></div>
      </div>
    </div>
    <div class="vdiv"></div>
    <div class="sw" style="min-width:125px"><div class="st"><span class="cl">Wsp√≥≈Çcz. e (sprƒô≈º.)</span><span class="sv" id="l7e">1.00</span></div><input type="range" id="sl7e" min="0" max="1" value="1" step="0.05" oninput="CL7.setE(this.value);UF(this)"></div>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b7pp" onclick="CL7.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="CL7.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

<!-- S8: PROJECTILE -->
<div class="sc" id="s8">
  <div class="rb">
    <div class="ri"><div class="rd" style="background:#fbbf24"></div><div><div class="rl">Czas lotu</div><div class="rv" id="r8t" style="color:#fbbf24">0.00 s</div></div></div>
    <div class="ri"><div class="rd" style="background:#34d399"></div><div><div class="rl">Zasiƒôg X</div><div class="rv" id="r8x" style="color:#34d399">0.0 m</div></div></div>
    <div class="ri"><div class="rd" style="background:#f472b6"></div><div><div class="rl">Wys. max H</div><div class="rv" id="r8h" style="color:#f472b6">0.0 m</div></div></div>
    <div class="ri"><div class="rd" style="background:#a78bfa"></div><div><div class="rl">Vx</div><div class="rv" id="r8vx" style="color:#a78bfa">0.0 m/s</div></div></div>
    <div class="ri"><div class="rd" style="background:#f87171"></div><div><div class="rl">Vy</div><div class="rv" id="r8vy" style="color:#f87171">0.0 m/s</div></div></div>
  </div>
  <div class="sa" id="w8"><canvas id="c8"></canvas><div class="sbdg samber" id="b8">RZUT UKO≈öNY</div></div>
  <div class="cp">
    <div class="sw" style="min-width:140px"><div class="st"><span class="cl">Prƒôdko≈õƒá v‚ÇÄ</span><span class="sv" id="l8v0">30 m/s</span></div><input type="range" id="sl8v0" min="5" max="100" value="30" step="1" oninput="PR8.setV0(this.value);UF(this)"></div>
    <div class="sw" style="min-width:128px"><div class="st"><span class="cl">KƒÖt Œ∏ [¬∞]</span><span class="sv" id="l8a">45¬∞</span></div><input type="range" id="sl8a" min="1" max="89" value="45" step="1" oninput="PR8.setA(this.value);UF(this)"></div>
    <div class="sw" style="min-width:128px"><div class="st"><span class="cl">Grawitacja</span><span class="sv" id="l8g">9.81 m/s¬≤</span></div><input type="range" id="sl8g" min="1" max="25" value="9.81" step="0.1" oninput="PR8.setG(this.value);UF(this)"></div>
    <label class="tw"><div class="tg"><input type="checkbox" id="t8vec" checked><div class="tgr"></div><div class="tgth"></div></div><span class="tgl">Wektory</span></label>
    <label class="tw"><div class="tg"><input type="checkbox" id="t8cmp"><div class="tgr"></div><div class="tgth"></div></div><span class="tgl">Por√≥wnaj kƒÖty</span></label>
    <div style="margin-left:auto;display:flex;gap:7px">
      <button class="btn pr" id="b8pp" onclick="PR8.pp()">‚ñ∂ Start</button>
      <button class="btn" onclick="PR8.reset()">‚Ü∫ Reset</button>
    </div>
  </div>
</div>

</div><!-- /main -->
<script>
const G=9.81,PF=50;

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function UF(el){const mn=+el.min,mx=+el.max,v=+el.value;el.style.setProperty('--pct',((v-mn)/(mx-mn)*100)+'%');}
document.querySelectorAll('input[type=range]').forEach(UF);
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function RC(c){const r=c.parentElement.getBoundingClientRect(),w=Math.round(r.width),h=Math.round(r.height);if(c.width!==w||c.height!==h){c.width=w;c.height=h;}}

// ‚îÄ‚îÄ DRAW PRIMITIVES ‚îÄ‚îÄ
function ARW(ctx,x1,y1,x2,y2,col,lw=2.5,hs=10){
  const d=Math.hypot(x2-x1,y2-y1);if(d<2)return;
  const a=Math.atan2(y2-y1,x2-x1);
  ctx.save();ctx.strokeStyle=col;ctx.fillStyle=col;ctx.lineWidth=lw;ctx.lineCap='round';
  ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
  ctx.beginPath();ctx.moveTo(x2,y2);ctx.lineTo(x2-hs*Math.cos(a-.42),y2-hs*Math.sin(a-.42));ctx.lineTo(x2-hs*Math.cos(a+.42),y2-hs*Math.sin(a+.42));ctx.closePath();ctx.fill();ctx.restore();
}
function TXT(ctx,t,x,y,col,sz=11,mono=false,al='center'){
  ctx.save();ctx.font=`${mono?500:700} ${sz}px ${mono?"'JetBrains Mono'":'Plus Jakarta Sans'},sans-serif`;ctx.fillStyle=col;ctx.textAlign=al;ctx.fillText(t,x,y);ctx.restore();
}
function RR(ctx,x,y,w,h,r,fill,stroke,sw=1.5){
  ctx.beginPath();if(ctx.roundRect)ctx.roundRect(x,y,w,h,r);else ctx.rect(x,y,w,h);
  if(fill){ctx.fillStyle=fill;ctx.fill();}if(stroke){ctx.strokeStyle=stroke;ctx.lineWidth=sw;ctx.stroke();}
}
function GROUND(ctx,y,W){
  const g=ctx.createLinearGradient(0,y,0,y+10);g.addColorStop(0,'rgba(99,102,241,.35)');g.addColorStop(1,'transparent');
  ctx.fillStyle=g;ctx.fillRect(0,y,W,10);
  ctx.save();ctx.strokeStyle='rgba(139,92,246,.55)';ctx.lineWidth=1;ctx.setLineDash([9,7]);
  ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();ctx.setLineDash([]);ctx.restore();
}
function OSC(ctx,W,H,data,col,label,unit=''){
  if(data.length<2)return;
  const gW=175,gH=64,gX=W-gW-10,gY=H-gH-10;
  ctx.save();
  RR(ctx,gX,gY,gW,gH,8,'rgba(4,3,10,.9)','rgba(99,102,241,.3)',1);
  for(let i=0;i<gH;i+=3){ctx.fillStyle='rgba(0,0,0,.04)';ctx.fillRect(gX,gY+i,gW,1);}
  TXT(ctx,label,gX+7,gY+13,'rgba(255,255,255,.2)',8,false,'left');
  const mn=Math.min(...data),mx=Math.max(...data),rng=Math.max(mx-mn,.001);
  if(mn<0&&mx>0){const zy=gY+gH-8-((0-mn)/rng)*(gH-24);ctx.strokeStyle='rgba(255,255,255,.08)';ctx.lineWidth=.5;ctx.setLineDash([3,3]);ctx.beginPath();ctx.moveTo(gX+6,zy);ctx.lineTo(gX+gW-6,zy);ctx.stroke();ctx.setLineDash([]);}
  ctx.shadowColor=col;ctx.shadowBlur=5;ctx.strokeStyle=col;ctx.lineWidth=1.5;ctx.beginPath();
  data.forEach((d,i)=>{const px=gX+6+(i/(data.length-1))*(gW-12),py=gY+gH-8-((d-mn)/rng)*(gH-24);i===0?ctx.moveTo(px,py):ctx.lineTo(px,py);});
  ctx.stroke();ctx.shadowBlur=0;
  TXT(ctx,data[data.length-1].toFixed(2)+unit,gX+gW-6,gY+13,col,9,true,'right');
  ctx.restore();
}

// ‚îÄ‚îÄ PRESETS ‚îÄ‚îÄ
const PRST=[
  {icon:'üì¶',label:'Skrzynka',mass:5, color:'#fbbf24',w:40,h:30},
  {icon:'üõí',label:'W√≥zek',  mass:20,color:'#a78bfa',w:60,h:28},
  {icon:'üßç',label:'Cz≈Çowiek',mass:70,color:'#f472b6',w:28,h:55},
];

function DRAWOBJ(ctx,oX,gY,p,mass,showM=true){
  const oW=p.w,oH=p.h,oTop=gY-oH;
  const g2=ctx.createLinearGradient(oX-oW/2,oTop,oX+oW/2,oTop+oH);
  g2.addColorStop(0,p.color);g2.addColorStop(1,p.color+'33');
  ctx.save();ctx.shadowColor=p.color+'44';ctx.shadowBlur=12;
  RR(ctx,oX-oW/2,oTop,oW,oH,8,g2,p.color,2);ctx.shadowBlur=0;
  ctx.font=`${Math.min(oH*.68,36)}px serif`;ctx.textAlign='center';ctx.fillText(p.icon,oX,oTop+oH*.66);
  if(showM){RR(ctx,oX-27,oTop-21,54,16,4,'rgba(0,0,0,.65)','rgba(255,255,255,.07)',.7);TXT(ctx,mass.toFixed(0)+' kg',oX,oTop-8,'#fff',9,true);}
  ctx.restore();
}

function SCENE(ctx,cv,x,v,Fa,Fn,Ff,a,mass,preset,trail,opts={}){
  RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
  const gY=H*.6,sX=W*.2,oX=clamp(sX+x*30,preset.w*.6,W-preset.w*.6);
  const oW=preset.w,oH=preset.h,oTop=gY-oH;
  GROUND(ctx,gY,W);
  if(opts.muL)TXT(ctx,opts.muL,W-12,gY+14,'rgba(255,255,255,.18)',8,true,'right');
  if(trail&&trail.length>1){
    ctx.save();const tg=ctx.createLinearGradient(sX,0,sX+400,0);tg.addColorStop(0,'rgba(167,139,250,0)');tg.addColorStop(1,'rgba(167,139,250,.16)');
    ctx.strokeStyle=tg;ctx.lineWidth=2;ctx.beginPath();
    trail.forEach((tx,i)=>{const px=clamp(sX+tx*30,preset.w*.6,W-preset.w*.6);i===0?ctx.moveTo(px,gY-2):ctx.lineTo(px,gY-2);});
    ctx.stroke();ctx.restore();
  }
  DRAWOBJ(ctx,oX,gY,preset,mass,opts.showM!==false);
  const aY=oTop+oH/2,sc=.4,mxL=W*.24;
  if(Math.abs(Fa)>.5){
    const len=clamp(Math.abs(Fa)*sc,8,mxL)*Math.sign(Fa),ax=oX+Math.sign(Fa)*oW/2;
    ARW(ctx,ax,aY,ax+len,aY,'#a78bfa',3.5);
    if(opts.lbl!==false)TXT(ctx,'F='+Fa.toFixed(0)+'N',ax+len/2,aY-13,'#a78bfa',9,true);
  }
  if(opts.ff&&Math.abs(Ff)>.5&&Math.abs(Fa)>.1){
    const len=clamp(Math.abs(Ff)*sc,6,mxL)*(-Math.sign(Ff)),fx=oX-Math.sign(Fa)*oW/2;
    ARW(ctx,fx,aY,fx+len,aY,'#f87171',3);
    if(opts.lbl!==false)TXT(ctx,'Ff='+Ff.toFixed(0)+'N',fx+len/2,aY-13,'#f87171',9,true);
  }
  if(opts.norm){
    const nl=clamp(mass*G*.15,14,50);ARW(ctx,oX,gY,oX,gY-nl-oH,'#34d399',2.5);
    TXT(ctx,'N='+(mass*G).toFixed(0)+'N',oX+44,gY-nl/2-oH/2,'#34d399',8,true);
  }
  if(Math.abs(Fn)>.5){
    const len=clamp(Math.abs(Fn)*sc,8,mxL)*Math.sign(Fn);
    ARW(ctx,oX,aY+26,oX+len,aY+26,'#fbbf24',5);
    if(opts.lbl!==false)TXT(ctx,'F_net='+Fn.toFixed(0)+'N',oX+len/2,aY+40,'#fbbf24',10,true);
  }else if(Math.abs(Fa)>.1&&opts.lbl!==false)TXT(ctx,'F_net=0',oX,aY+32,'#34d399',10,true);
  if(Math.abs(v)>.08){
    const vl=clamp(Math.abs(v)*10,4,60)*Math.sign(v);
    ctx.save();ctx.strokeStyle='#22d3ee55';ctx.lineWidth=1.5;ctx.setLineDash([4,4]);
    ctx.beginPath();ctx.moveTo(oX+Math.sign(v)*oW/2,gY-4);ctx.lineTo(oX+Math.sign(v)*oW/2+vl,gY-4);ctx.stroke();ctx.setLineDash([]);ctx.restore();
    TXT(ctx,'v='+v.toFixed(1)+'m/s',oX+Math.sign(v)*oW/2+vl/2,gY+13,'#22d3ee',9,true);
  }
}

// ‚îÄ‚îÄ ENGINE (screens 2,3,4) ‚îÄ‚îÄ
function MKE(cid,hasFric,onD,onR){
  const cv=document.getElementById(cid),ctx=cv.getContext('2d');
  let mass=20,Fa=0,mu=0,preset=PRST[1],running=false,raf=null,last=null,x=0,v=0,t=0;
  const trail=[];
  const N_=()=>mass*G;
  const Ff_=()=>{if(!hasFric)return 0;if(Math.abs(v)<.05){const fs=mu*N_();return Math.abs(Fa)<=fs?Fa:Math.sign(Fa)*fs;}return Math.sign(v)*mu*N_();};
  const Fn_=()=>Fa-Ff_(),a_=()=>Fn_()/mass;
  function setF(val){Fa=+val;if(!running){draw();onR();}}
  function setM(val){mass=+val;if(!running){draw();onR();}}
  function setMu(val){mu=+val;if(!running){draw();onR();}}
  function setP(p){preset=p;mass=p.mass;if(!running){draw();onR();}}
  function pp(){running=!running;if(running){last=null;raf=requestAnimationFrame(loop);}else{cancelAnimationFrame(raf);draw();}return running;}
  function reset(){running=false;x=0;v=0;t=0;trail.length=0;last=null;cancelAnimationFrame(raf);draw();onR();return false;}
  function loop(ts){if(!running)return;if(!last)last=ts;const dt=Math.min((ts-last)/1000,.05);last=ts;const a=a_();v+=a*dt;if(hasFric&&Math.abs(Fa)<.1&&Math.abs(v)<.08)v=0;x+=v*dt;t+=dt;trail.push(x);if(trail.length>400)trail.shift();draw();onR();raf=requestAnimationFrame(loop);}
  function draw(){onD(ctx,cv,{x,v,Fa,Fn:Fn_(),Ff:Ff_(),a:a_(),mass,mu,preset,trail,running,t});}
  function st(){return{x,v,Fa,Fn:Fn_(),Ff:Ff_(),a:a_(),mass,mu,preset,running,t};}
  return{setF,setM,setMu,setP,pp,reset,draw,st};
}

// ‚îÄ‚îÄ S1: TUG OF WAR ‚îÄ‚îÄ
const T1=(()=>{
  let pL=0,pR=0,mass=20,running=false,raf=null,last=null,x=0,v=0;
  const cv=document.getElementById('c1'),ctx=cv.getContext('2d');
  const fl=()=>pL*PF,fr=()=>pR*PF,fn=()=>fr()-fl(),ac=()=>fn()/mass;
  function add(d){if(d<0&&pL<6)pL++;else if(d>0&&pR<6)pR++;sync();}
  function rem(d){if(d<0&&pL>0)pL--;else if(d>0&&pR>0)pR--;sync();}
  function setM(m){mass=+m;document.getElementById('l1m').textContent=m+' kg';sync();}
  function sync(){document.getElementById('l1lc').textContent='√ó'+pL;document.getElementById('l1rc').textContent='√ó'+pR;rd();if(!running)draw();}
  function rd(){
    document.getElementById('r1fl').textContent=fl().toFixed(0)+' N';
    document.getElementById('r1fr').textContent=fr().toFixed(0)+' N';
    document.getElementById('r1fn').textContent=fn().toFixed(0)+' N';
    document.getElementById('r1v').textContent=v.toFixed(2)+' m/s';
    document.getElementById('r1a').textContent=ac().toFixed(3)+' m/s¬≤';
    const b=document.getElementById('b1');
    if(Math.abs(fn())<.5){b.textContent='R√ìWNOWAGA';b.className='sbdg sgreen';}else{b.textContent='RUCH';b.className='sbdg samber';}
  }
  function pp(){running=!running;document.getElementById('b1pp').innerHTML=running?'‚è∏ Pauza':'‚ñ∂ Start';if(running){last=null;raf=requestAnimationFrame(loop);}else{cancelAnimationFrame(raf);draw();}}
  function reset(){running=false;x=0;v=0;last=null;cancelAnimationFrame(raf);document.getElementById('b1pp').innerHTML='‚ñ∂ Start';draw();rd();}
  function loop(ts){if(!running)return;if(!last)last=ts;const dt=Math.min((ts-last)/1000,.05);last=ts;v+=ac()*dt;x+=v*dt;const W=cv.width,lim=W*.3;x=clamp(x,-lim,lim);if(Math.abs(x)>=lim)v=0;draw();rd();raf=requestAnimationFrame(loop);}
  function draw(){
    RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
    const sv=document.getElementById('t1sv').checked;
    const cx=W/2,gY=H*.6,cX=cx+x*1.8,cW=90,cH=44;
    GROUND(ctx,gY,W);
    // rope gradient
    const rg=ctx.createLinearGradient(30,0,W-30,0);rg.addColorStop(0,'#f87171bb');rg.addColorStop(.5,'#a78bfabb');rg.addColorStop(1,'#60a5fabb');
    ctx.save();ctx.strokeStyle=rg;ctx.lineWidth=4.5;ctx.lineCap='round';
    ctx.beginPath();ctx.moveTo(cX-cW/2,gY-cH/2);ctx.lineTo(30,gY-cH/2);ctx.stroke();
    ctx.beginPath();ctx.moveTo(cX+cW/2,gY-cH/2);ctx.lineTo(W-30,gY-cH/2);ctx.stroke();ctx.restore();
    // cart glow
    ctx.save();ctx.shadowColor='rgba(167,139,250,.6)';ctx.shadowBlur=24;
    RR(ctx,cX-cW/2,gY-cH,cW,cH,10,'rgba(139,92,246,.2)','#a78bfa',2.5);ctx.shadowBlur=0;
    // wheels
    [[cX-26,gY+7],[cX+26,gY+7]].forEach(([wx,wy])=>{
      ctx.beginPath();ctx.arc(wx,wy,8,0,Math.PI*2);ctx.fillStyle='rgba(255,255,255,.05)';ctx.fill();ctx.strokeStyle='#a78bfa';ctx.lineWidth=1.8;ctx.stroke();
      ctx.beginPath();ctx.arc(wx,wy,2.5,0,Math.PI*2);ctx.fillStyle='#a78bfa';ctx.fill();
      ctx.strokeStyle='rgba(167,139,250,.4)';ctx.lineWidth=1;
      ctx.beginPath();ctx.moveTo(wx,wy-8);ctx.lineTo(wx,wy+8);ctx.stroke();
      ctx.beginPath();ctx.moveTo(wx-8,wy);ctx.lineTo(wx+8,wy);ctx.stroke();
    });
    ctx.restore();
    TXT(ctx,'‚öñÔ∏è',cX,gY-cH/2+9,'#fff',20);
    if(sv)TXT(ctx,mass+' kg',cX,gY-cH-10,'rgba(255,255,255,.28)',9,true);
    // pullers
    for(let i=0;i<pL;i++)drawPuller(ctx,cX-cW/2-34-i*40,gY-22,-1,'#f87171',sv?PF:0);
    for(let i=0;i<pR;i++)drawPuller(ctx,cX+cW/2+34+i*40,gY-22,1,'#60a5fa',sv?PF:0);
    // arrows
    const ay=gY-cH-26,scl=Math.max(fl(),fr(),1),mxL=clamp(W*.25,80,200);
    if(fl()>0){const len=fl()/scl*mxL;ARW(ctx,cX,ay,cX-len,ay,'#f87171',3.5);if(sv)TXT(ctx,fl().toFixed(0)+' N',cX-len/2,ay-12,'#f87171',9,true);}
    if(fr()>0){const len=fr()/scl*mxL;ARW(ctx,cX,ay,cX+len,ay,'#60a5fa',3.5);if(sv)TXT(ctx,fr().toFixed(0)+' N',cX+len/2,ay-12,'#60a5fa',9,true);}
    if(Math.abs(fn())>.5){const len=Math.abs(fn())/scl*mxL*Math.sign(fn());ARW(ctx,cX,ay+26,cX+len,ay+26,'#a78bfa',5.5);if(sv)TXT(ctx,'F_net='+fn().toFixed(0)+' N',cX+len/2,ay+40,'#a78bfa',10,true);}
    else if(sv&&(fl()>0||fr()>0))TXT(ctx,'F_net = 0',cX,ay+32,'#34d399',10,true);
    if(Math.abs(x)>.5)TXT(ctx,(x>0?'‚Üí':'‚Üê')+' '+Math.abs(x/1.8).toFixed(1)+' m',cX,gY+22,'rgba(255,255,255,.25)',8,true);
  }
  return{add,rem,setM,pp,reset,rd,draw};
})();

function drawPuller(ctx,x,y,dir,col,fv){
  ctx.save();ctx.shadowColor=col;ctx.shadowBlur=10;
  const bW=19,bH=26,bx=dir<0?x-bW-1:x+1;
  ctx.fillStyle=col+'cc';RR(ctx,bx,y-bH/2+1,bW,bH-4,3,col+'cc',null);
  ctx.beginPath();ctx.arc(bx+bW/2,y-bH/2-5,6,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;
  const armY=y-bH/4,armX=dir<0?bx-7:bx+bW+7;
  ctx.strokeStyle=col;ctx.lineWidth=2.5;ctx.lineCap='round';ctx.beginPath();ctx.moveTo(bx+(dir<0?0:bW),armY);ctx.lineTo(armX,armY);ctx.stroke();
  if(fv>0){TXT(ctx,fv.toFixed(0)+' N',bx+bW/2,y-bH/2-17,col,8,true);}
  ctx.restore();
}

// ‚îÄ‚îÄ S2: MOTION ‚îÄ‚îÄ
const M2=(()=>{
  const hist=[];
  const e=MKE('c2',false,(ctx,cv,st)=>{
    const sT=document.getElementById('t2tr').checked;
    SCENE(ctx,cv,st.x,st.v,st.Fa,st.Fn,st.Ff,st.a,st.mass,st.preset,sT?st.trail:null,{lbl:true,ff:false,norm:false});
    hist.push(st.v);if(hist.length>100)hist.shift();
    OSC(ctx,cv.width,cv.height,hist,'#34d399','Prƒôdko≈õƒá [m/s]','');
  },()=>{
    const s=e.st();
    document.getElementById('r2f').textContent=s.Fa.toFixed(0)+' N';
    document.getElementById('r2v').textContent=s.v.toFixed(2)+' m/s';
    document.getElementById('r2a').textContent=s.a.toFixed(3)+' m/s¬≤';
    document.getElementById('r2x').textContent=s.x.toFixed(2)+' m';
    document.getElementById('r2t').textContent=s.t.toFixed(2)+' s';
  });
  function setF(v){e.setF(v);document.getElementById('l2f').textContent=(+v).toFixed(0)+' N';}
  function pp(){const r=e.pp();document.getElementById('b2pp').innerHTML=r?'‚è∏ Pauza':'‚ñ∂ Start';}
  function reset(){e.reset();hist.length=0;document.getElementById('b2pp').innerHTML='‚ñ∂ Start';document.getElementById('sl2f').value=0;UF(document.getElementById('sl2f'));e.setF(0);document.getElementById('l2f').textContent='0 N';}
  function buildUI(){const c=document.getElementById('pr2');c.innerHTML='';PRST.forEach((p,i)=>{const b=document.createElement('button');b.className='pgb'+(i===1?' active':'');b.innerHTML=`<span class="pgi">${p.icon}</span><span class="pgn">${p.label}</span><span class="pgm">${p.mass} kg</span>`;b.onclick=()=>{document.querySelectorAll('#pr2 .pgb').forEach(x=>x.classList.remove('active'));b.classList.add('active');e.setP(p);};c.appendChild(b);});}
  return{setF,pp,reset,buildUI,e};
})();

// ‚îÄ‚îÄ S3: FRICTION ‚îÄ‚îÄ
const M3=(()=>{
  const e=MKE('c3',true,(ctx,cv,st)=>{
    SCENE(ctx,cv,st.x,st.v,st.Fa,st.Fn,st.Ff,st.a,st.mass,st.preset,st.trail,{lbl:true,ff:true,norm:true,muL:'Œº = '+st.mu.toFixed(2)});
    const b=document.getElementById('b3');
    if(Math.abs(st.v)<.05&&Math.abs(st.Fa)<=st.mu*st.mass*G){b.textContent='STATYKA';b.className='sbdg sblue';}else{b.textContent='RUCH KINETYCZNY';b.className='sbdg samber';}
    TXT(ctx,'* Œº_s ‚âà Œº_k (model uproszczony)',cv.width-10,cv.height-6,'rgba(255,255,255,.1)',8,true,'right');
  },()=>{
    const s=e.st();
    document.getElementById('r3f').textContent=s.Fa.toFixed(0)+' N';
    document.getElementById('r3ff').textContent=s.Ff.toFixed(0)+' N';
    document.getElementById('r3fn').textContent=s.Fn.toFixed(0)+' N';
    document.getElementById('r3v').textContent=s.v.toFixed(2)+' m/s';
    document.getElementById('r3mu').textContent=s.mu.toFixed(2);
  });
  function setF(v){e.setF(v);document.getElementById('l3f').textContent=(+v).toFixed(0)+' N';}
  function setMu(v){e.setMu(v);document.getElementById('l3mu').textContent=(+v).toFixed(2);}
  function pp(){const r=e.pp();document.getElementById('b3pp').innerHTML=r?'‚è∏ Pauza':'‚ñ∂ Start';}
  function reset(){e.reset();document.getElementById('b3pp').innerHTML='‚ñ∂ Start';document.getElementById('sl3f').value=0;UF(document.getElementById('sl3f'));e.setF(0);document.getElementById('l3f').textContent='0 N';}
  function buildUI(){const c=document.getElementById('pr3');c.innerHTML='';PRST.forEach((p,i)=>{const b=document.createElement('button');b.className='pgb'+(i===0?' active':'');b.innerHTML=`<span class="pgi">${p.icon}</span><span class="pgn">${p.label}</span><span class="pgm">${p.mass} kg</span>`;b.onclick=()=>{document.querySelectorAll('#pr3 .pgb').forEach(x=>x.classList.remove('active'));b.classList.add('active');e.setP(p);};c.appendChild(b);});e.setP(PRST[0]);}
  return{setF,setMu,pp,reset,buildUI,e};
})();

// ‚îÄ‚îÄ S4: ACCELERATION ‚îÄ‚îÄ
const M4=(()=>{
  const hist=[];
  const e=MKE('c4',true,(ctx,cv,st)=>{
    RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
    const sp=W*.5;
    ctx.save();ctx.beginPath();ctx.rect(0,0,sp,H);ctx.clip();
    const fc={width:sp,height:H,parentElement:cv.parentElement};
    SCENE(ctx,fc,st.x,st.v,st.Fa,st.Fn,st.Ff,st.a,st.mass,st.preset,null,{lbl:false,ff:true,norm:false});
    ctx.restore();
    ctx.save();ctx.strokeStyle='rgba(99,102,241,.2)';ctx.lineWidth=1;ctx.setLineDash([6,6]);ctx.beginPath();ctx.moveTo(sp,14);ctx.lineTo(sp,H-14);ctx.stroke();ctx.setLineDash([]);ctx.restore();
    const showF=document.getElementById('t4sf').checked;
    const rx=sp+(W-sp)/2,ry=H/2-28;
    if(showF){
      TXT(ctx,'F = m ¬∑ a',rx,ry-50,'rgba(255,255,255,.15)',18,true);
      TXT(ctx,'a = F_net / m',rx,ry-28,'rgba(255,255,255,.08)',12,true);
      ctx.save();ctx.shadowColor='rgba(167,139,250,.7)';ctx.shadowBlur=28;
      const grd=ctx.createLinearGradient(rx-80,0,rx+80,0);grd.addColorStop(0,'#a78bfa');grd.addColorStop(1,'#f472b6');
      ctx.font="700 52px 'JetBrains Mono',monospace";ctx.textAlign='center';ctx.fillStyle=grd;ctx.fillText(st.a.toFixed(3),rx,ry+30);
      ctx.shadowBlur=0;ctx.font="600 12px 'Plus Jakarta Sans',sans-serif";ctx.fillStyle='rgba(255,255,255,.25)';ctx.fillText('m/s¬≤',rx,ry+50);
      RR(ctx,rx-96,ry+60,192,22,6,'rgba(99,102,241,.12)',null);
      TXT(ctx,st.Fn.toFixed(1)+' N √∑ '+st.mass.toFixed(0)+' kg',rx,ry+74,'rgba(255,255,255,.3)',10,true);
      ctx.restore();
    }
    hist.push(st.a);if(hist.length>100)hist.shift();
    OSC(ctx,W,H,hist,'#a78bfa','Przyspieszenie a','');
  },()=>{
    const s=e.st();
    document.getElementById('r4f').textContent=s.Fa.toFixed(0)+' N';
    document.getElementById('r4ff').textContent=s.Ff.toFixed(0)+' N';
    document.getElementById('r4fn').textContent=s.Fn.toFixed(0)+' N';
    document.getElementById('r4a').textContent=s.a.toFixed(3)+' m/s¬≤';
    document.getElementById('r4m').textContent=s.mass.toFixed(0)+' kg';
  });
  function setF(v){e.setF(v);document.getElementById('l4f').textContent=(+v).toFixed(0)+' N';}
  function setM(v){e.setM(v);document.getElementById('l4m').textContent=(+v).toFixed(0)+' kg';}
  function setMu(v){e.setMu(v);document.getElementById('l4mu').textContent=(+v).toFixed(2);}
  function pp(){const r=e.pp();document.getElementById('b4pp').innerHTML=r?'‚è∏ Pauza':'‚ñ∂ Start';}
  function reset(){e.reset();hist.length=0;document.getElementById('b4pp').innerHTML='‚ñ∂ Start';document.getElementById('sl4f').value=0;UF(document.getElementById('sl4f'));e.setF(0);document.getElementById('l4f').textContent='0 N';}
  return{setF,setM,setMu,pp,reset,e};
})();

// ‚îÄ‚îÄ S5: PENDULUM ‚îÄ‚îÄ
const P5=(()=>{
  const cv=document.getElementById('c5'),ctx=cv.getContext('2d');
  let L=1,th=30*Math.PI/180,om=0,damp=0,g=9.81,ang0=30*Math.PI/180;
  let run=false,raf=null,last=null,pTrl=[],thHist=[],omHist=[];
  let lastSign=0,halfClock=0,periodT=0;

  function setL(v){L=+v;document.getElementById('l5L').textContent=(+v).toFixed(2)+' m';if(!run){th=ang0;om=0;draw();}}
  function setA(v){ang0=+v*Math.PI/180;document.getElementById('l5a').textContent=v+'¬∞';if(!run){th=ang0;om=0;draw();}}
  function setD(v){damp=+v;document.getElementById('l5d').textContent=(+v).toFixed(2);}
  function setG(v){g=+v;document.getElementById('l5g').textContent=(+v).toFixed(2)+' m/s¬≤';}
  function pp(){run=!run;document.getElementById('b5pp').innerHTML=run?'‚è∏ Pauza':'‚ñ∂ Start';if(run){last=null;raf=requestAnimationFrame(loop);}else cancelAnimationFrame(raf);}
  function reset(){run=false;th=ang0;om=0;pTrl=[];thHist=[];omHist=[];periodT=0;halfClock=0;lastSign=0;cancelAnimationFrame(raf);document.getElementById('b5pp').innerHTML='‚ñ∂ Start';draw();rd();}

  function loop(ts){
    if(!run)return;if(!last)last=ts;
    const dt=Math.min((ts-last)/1000,.018);last=ts;
    // RK4
    const f=(t2,o2)=>({dt:o2,do:-(g/L)*Math.sin(t2)-damp*o2});
    const k1=f(th,om);
    const k2=f(th+.5*dt*k1.dt,om+.5*dt*k1.do);
    const k3=f(th+.5*dt*k2.dt,om+.5*dt*k2.do);
    const k4=f(th+dt*k3.dt,om+dt*k3.do);
    th+=(dt/6)*(k1.dt+2*k2.dt+2*k3.dt+k4.dt);
    om+=(dt/6)*(k1.do+2*k2.do+2*k3.do+k4.do);
    // half-period detection (sign change of velocity while going through centre)
    const sg=Math.sign(om);
    if(lastSign!==0&&sg!==0&&sg!==lastSign){halfClock+=dt;if(halfClock>.1){periodT=halfClock*2;halfClock=0;}}
    else halfClock+=dt;
    lastSign=sg;
    pTrl.push([th,om]);if(pTrl.length>700)pTrl.shift();
    thHist.push(th);if(thHist.length>100)thHist.shift();
    draw();rd();raf=requestAnimationFrame(loop);
  }
  function rd(){
    const E=.5*1*Math.pow(L*om,2)+1*g*L*(1-Math.cos(th));
    document.getElementById('r5ang').textContent=(th*180/Math.PI).toFixed(1)+'¬∞';
    document.getElementById('r5om').textContent=om.toFixed(3)+' rad/s';
    document.getElementById('r5per').textContent=periodT>0?periodT.toFixed(3)+' s':'‚Äî';
    document.getElementById('r5en').textContent=E.toFixed(3)+' J';
    const Tlin=2*Math.PI*Math.sqrt(L/g);
    document.getElementById('r5tlin').textContent=Tlin.toFixed(3)+' s';
  }
  function draw(){
    RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
    const showPh=document.getElementById('t5ph').checked;
    const pivX=W*(showPh?.37:.5),pivY=H*.12;
    const ppM=Math.min(H*.62/Math.max(L,.1),140);
    const bx=pivX+Math.sin(th)*L*ppM,by=pivY+Math.cos(th)*L*ppM;

    // phase portrait
    if(showPh&&pTrl.length>1){
      const ppX=W*.78,ppY=H*.44,ppR=Math.min(W*.17,H*.34);
      ctx.save();
      ctx.beginPath();ctx.arc(ppX,ppY,ppR,0,Math.PI*2);ctx.fillStyle='rgba(99,102,241,.03)';ctx.fill();ctx.strokeStyle='rgba(99,102,241,.12)';ctx.lineWidth=1;ctx.stroke();
      ctx.strokeStyle='rgba(255,255,255,.07)';ctx.lineWidth=.5;
      ctx.beginPath();ctx.moveTo(ppX-ppR,ppY);ctx.lineTo(ppX+ppR,ppY);ctx.stroke();
      ctx.beginPath();ctx.moveTo(ppX,ppY-ppR);ctx.lineTo(ppX,ppY+ppR);ctx.stroke();
      TXT(ctx,'Œ∏',ppX+ppR+10,ppY+4,'rgba(255,255,255,.18)',8);TXT(ctx,'œâ',ppX+2,ppY-ppR-6,'rgba(255,255,255,.18)',8);
      const mxT=Math.max(Math.abs(ang0),.3),mxO=Math.sqrt(2*g/L*(1-Math.cos(ang0)))+.3;
      ctx.beginPath();
      pTrl.forEach(([t2,o2],i)=>{
        const px=ppX+(t2/mxT)*ppR*.9,py=ppY-(o2/mxO)*ppR*.9;
        i===0?ctx.moveTo(px,py):ctx.lineTo(px,py);
      });
      const grad=ctx.createLinearGradient(ppX-ppR,ppY,ppX+ppR,ppY);
      grad.addColorStop(0,'#a78bfa');grad.addColorStop(1,'#f472b6');
      ctx.strokeStyle=grad;ctx.lineWidth=1.4;ctx.shadowColor='#a78bfa55';ctx.shadowBlur=4;ctx.stroke();
      ctx.shadowBlur=0;
      // current point
      const px=ppX+(th/mxT)*ppR*.9,py=ppY-(om/mxO)*ppR*.9;
      ctx.beginPath();ctx.arc(px,py,4,0,Math.PI*2);ctx.fillStyle='#f472b6';ctx.fill();
      TXT(ctx,'PORTRET FAZOWY',ppX,ppY+ppR+14,'rgba(255,255,255,.2)',7);
      ctx.restore();
    }

    // equilibrium angle guide
    ctx.save();ctx.strokeStyle='rgba(255,255,255,.06)';ctx.lineWidth=1;ctx.setLineDash([5,8]);
    ctx.beginPath();ctx.moveTo(pivX,pivY);ctx.lineTo(pivX,pivY+L*ppM);ctx.stroke();ctx.setLineDash([]);ctx.restore();

    // angle arc
    if(Math.abs(th)>.02){
      ctx.save();ctx.strokeStyle='rgba(244,114,182,.25)';ctx.lineWidth=1.5;
      ctx.beginPath();ctx.arc(pivX,pivY,L*ppM*.25,Math.PI/2,Math.PI/2+th,th<0);ctx.stroke();
      TXT(ctx,(th*180/Math.PI).toFixed(0)+'¬∞',pivX+Math.sin(th/2)*L*ppM*.32,pivY+Math.cos(th/2)*L*ppM*.32,'#f472b6aa',9,true);
      ctx.restore();
    }

    // string glow
    ctx.save();ctx.shadowColor='#a78bfa66';ctx.shadowBlur=8;
    ctx.strokeStyle='rgba(167,139,250,.7)';ctx.lineWidth=2.5;ctx.lineCap='round';
    ctx.beginPath();ctx.moveTo(pivX,pivY);ctx.lineTo(bx,by);ctx.stroke();
    ctx.shadowBlur=0;ctx.restore();

    // pivot
    ctx.save();ctx.shadowColor='#a78bfa';ctx.shadowBlur=12;
    ctx.beginPath();ctx.arc(pivX,pivY,6,0,Math.PI*2);ctx.fillStyle='#a78bfa';ctx.fill();ctx.shadowBlur=0;ctx.restore();

    // bob with glow
    const spd=Math.abs(om);const bobR=16;
    ctx.save();
    ctx.shadowColor='#f472b6';ctx.shadowBlur=14+spd*4;
    const bg=ctx.createRadialGradient(bx,by,2,bx,by,bobR);
    bg.addColorStop(0,'#f9a8d4');bg.addColorStop(1,'#ec4899');
    ctx.beginPath();ctx.arc(bx,by,bobR,0,Math.PI*2);ctx.fillStyle=bg;ctx.fill();
    ctx.strokeStyle='#f472b6';ctx.lineWidth=2;ctx.stroke();ctx.shadowBlur=0;ctx.restore();
    TXT(ctx,'m=1kg',bx,by+bobR+12,'rgba(255,255,255,.3)',8,true);

    // velocity arrow on bob
    const vx=om*L*ppM*.3*Math.cos(th),vy=-om*L*ppM*.3*Math.sin(th);
    if(Math.abs(om)>.05)ARW(ctx,bx,by,bx+vx,by+vy,'#34d399',2.5,8);

    // theta history as oscilloscope
    OSC(ctx,W,H,thHist,'#f472b6','KƒÖt Œ∏ [rad]','');
    // analytic T label
    const Tl=2*Math.PI*Math.sqrt(L/g);
    TXT(ctx,'T = 2œÄ‚àö(L/g) = '+Tl.toFixed(3)+' s',pivX,pivY-14,'rgba(255,255,255,.22)',9,true);
  }
  return{setL,setA,setD,setG,pp,reset};
})();

// ‚îÄ‚îÄ S6: SPRING / HOOKE ‚îÄ‚îÄ
const SP6=(()=>{
  const cv=document.getElementById('c6'),ctx=cv.getContext('2d');
  let k=20,m=1,x0=.5,damp=0,x=.5,v=0,run=false,raf=null,last=null;
  const xHist=[],eHist=[];

  function setK(val){k=+val;document.getElementById('l6k').textContent=(+val).toFixed(0)+' N/m';if(!run){x=x0;v=0;draw();}}
  function setM(val){m=+val;document.getElementById('l6m').textContent=(+val).toFixed(1)+' kg';if(!run)draw();}
  function setX0(val){x0=+val;document.getElementById('l6x').textContent=(+val).toFixed(2)+' m';if(!run){x=x0;v=0;draw();}}
  function setD(val){damp=+val;document.getElementById('l6d').textContent=(+val).toFixed(2);}
  function pp(){run=!run;document.getElementById('b6pp').innerHTML=run?'‚è∏ Pauza':'‚ñ∂ Start';if(run){last=null;raf=requestAnimationFrame(loop);}else cancelAnimationFrame(raf);}
  function reset(){run=false;x=x0;v=0;xHist.length=0;eHist.length=0;last=null;cancelAnimationFrame(raf);document.getElementById('b6pp').innerHTML='‚ñ∂ Start';draw();rd();}
  function loop(ts){if(!run)return;if(!last)last=ts;const dt=Math.min((ts-last)/1000,.018);last=ts;const a=(-k*x-damp*v)/m;v+=a*dt;x+=v*dt;xHist.push(x);if(xHist.length>120)xHist.shift();eHist.push(.5*k*x*x);if(eHist.length>120)eHist.shift();draw();rd();raf=requestAnimationFrame(loop);}
  function rd(){
    const Ep=.5*k*x*x,Ek=.5*m*v*v,T=2*Math.PI*Math.sqrt(m/k);
    document.getElementById('r6x').textContent=x.toFixed(3)+' m';
    document.getElementById('r6f').textContent=(-k*x).toFixed(1)+' N';
    document.getElementById('r6ep').textContent=Ep.toFixed(3)+' J';
    document.getElementById('r6ek').textContent=Ek.toFixed(3)+' J';
    document.getElementById('r6per').textContent=T.toFixed(3)+' s';
    const b=document.getElementById('b6');
    if(damp>2*Math.sqrt(k*m))b.textContent='T≈ÅUMIENIE NADKRYTYCZNE';
    else if(damp===2*Math.sqrt(k*m))b.textContent='T≈ÅUMIENIE KRYTYCZNE';
    else if(damp>0)b.textContent='T≈ÅUMIENIE PODKRYTYCZNE';
    else b.textContent="PRAWO HOOKE'A: F = ‚àíkx";
    b.className='sbdg '+(damp>.05?'samber':'sgreen');
  }
  function drawSpringCoil(ctx,x1,y1,x2,y2,coils,col){
    const dx=x2-x1,dy=y2-y1,len=Math.hypot(dx,dy);
    const ang=Math.atan2(dy,dx);
    const amp=14,segW=len/coils/4;
    ctx.save();ctx.translate(x1,y1);ctx.rotate(ang);
    ctx.strokeStyle=col;ctx.lineWidth=2.5;ctx.lineCap='round';ctx.lineJoin='round';
    ctx.beginPath();ctx.moveTo(0,0);
    let cx2=16;ctx.lineTo(cx2,0);
    for(let i=0;i<coils;i++){
      ctx.lineTo(cx2+segW,amp);ctx.lineTo(cx2+segW*2,-amp);
      ctx.lineTo(cx2+segW*3,amp);ctx.lineTo(cx2+segW*4,0);
      cx2+=segW*4;
    }
    ctx.lineTo(len,0);ctx.stroke();ctx.restore();
  }
  function draw(){
    RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
    const wallX=W*.08,eqX=W*.45,massX=eqX+x*(W*.25/Math.max(x0,.1));
    const massY=H*.5,mW=50,mH=50;

    // wall
    ctx.save();ctx.fillStyle='rgba(99,102,241,.22)';ctx.fillRect(wallX-14,H*.25,14,H*.5);
    ctx.strokeStyle='rgba(139,92,246,.5)';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(wallX,H*.25);ctx.lineTo(wallX,H*.75);ctx.stroke();
    // hatch
    ctx.strokeStyle='rgba(99,102,241,.25)';ctx.lineWidth=1;
    for(let i=0;i<8;i++){ctx.beginPath();ctx.moveTo(wallX-14,H*.25+i*H*.062);ctx.lineTo(wallX,H*.25+i*H*.062+12);ctx.stroke();}
    ctx.restore();

    // equilibrium line
    ctx.save();ctx.strokeStyle='rgba(255,255,255,.1)';ctx.lineWidth=1;ctx.setLineDash([5,7]);
    ctx.beginPath();ctx.moveTo(eqX,H*.25);ctx.lineTo(eqX,H*.75);ctx.stroke();
    ctx.setLineDash([]);ctx.restore();
    TXT(ctx,'x=0',eqX,H*.25-6,'rgba(255,255,255,.2)',8,true);

    // spring
    ctx.save();ctx.shadowColor='#34d39966';ctx.shadowBlur=8;
    drawSpringCoil(ctx,wallX,massY,massX-mW/2,massY,8,'#34d399');
    ctx.restore();

    // displacement arrow
    if(Math.abs(x)>.02){
      ARW(ctx,eqX,massY+mH/2+18,massX,massY+mH/2+18,x>0?'#f87171':'#60a5fa',2.5);
      TXT(ctx,'x='+x.toFixed(2)+'m',eqX+x*(W*.25/Math.max(x0,.1))/2,massY+mH/2+32,x>0?'#f87171':'#60a5fa',9,true);
    }

    // mass block
    const mG=ctx.createLinearGradient(massX-mW/2,massY-mH/2,massX+mW/2,massY+mH/2);
    mG.addColorStop(0,'#a78bfa');mG.addColorStop(1,'#6366f155');
    ctx.save();ctx.shadowColor='#a78bfa88';ctx.shadowBlur=18+Math.abs(v)*5;
    RR(ctx,massX-mW/2,massY-mH/2,mW,mH,10,mG,'#a78bfa',2.5);ctx.shadowBlur=0;
    TXT(ctx,'m',massX,massY+5,'#fff',13,true);TXT(ctx,m.toFixed(1)+' kg',massX,massY+mH/2+14,'rgba(255,255,255,.3)',8,true);
    ctx.restore();

    // force arrow on mass
    const F=-k*x;
    if(Math.abs(F)>1){const len=clamp(Math.abs(F)*.3,10,100)*Math.sign(F);ARW(ctx,massX,massY-mH/2-8,massX+len,massY-mH/2-8,'#f87171',3);TXT(ctx,'F='+F.toFixed(1)+'N',massX+len/2,massY-mH/2-20,'#f87171',9,true);}

    // energy bars
    const barH=90,barX=W*.82,barY=H*.15;
    const Ep=.5*k*x*x,Ek=.5*m*v*v,Et=.5*k*x0*x0+.5*m*v*v;
    const maxE=Math.max(.5*k*x0*x0,.01);
    RR(ctx,barX,barY,26,barH,4,'rgba(255,255,255,.04)','rgba(255,255,255,.08)',1);
    const epH=(Ep/maxE)*barH;RR(ctx,barX,barY+barH-epH,26,epH,4,'rgba(167,139,250,.7)',null);
    RR(ctx,barX+32,barY,26,barH,4,'rgba(255,255,255,.04)','rgba(255,255,255,.08)',1);
    const ekH=(Ek/maxE)*barH;RR(ctx,barX+32,barY+barH-ekH,26,ekH,4,'rgba(251,191,36,.7)',null);
    TXT(ctx,'Ep',barX+13,barY+barH+13,'#a78bfa',8,true);TXT(ctx,'Ek',barX+45,barY+barH+13,'#fbbf24',8,true);
    TXT(ctx,'Ep='+Ep.toFixed(2)+'J',barX+13,barY-6,'rgba(255,255,255,.3)',7,true);
    TXT(ctx,'Ek='+Ek.toFixed(2)+'J',barX+45,barY-6,'rgba(255,255,255,.3)',7,true);

    OSC(ctx,W,H,xHist,'#34d399','Wychylenie x [m]','');
  }
  return{setK,setM,setX0,setD,pp,reset};
})();

// ‚îÄ‚îÄ S7: COLLISIONS ‚îÄ‚îÄ
const CL7=(()=>{
  const cv=document.getElementById('c7'),ctx=cv.getContext('2d');
  let m1=2,m2=2,v1i=5,v2i=-3,e=1;
  let x1,x2,v1,v2,run=false,raf=null,last=null,collided=false,phase=0;
  const W_=()=>cv.width,H_=()=>cv.height;
  const r1=()=>14+m1*2.5,r2=()=>14+m2*2.5;
  function initPos(){x1=W_()*0.22;x2=W_()*0.75;v1=v1i;v2=v2i;collided=false;phase=0;}
  function setM1(v){m1=+v;document.getElementById('l7m1').textContent=(+v).toFixed(1)+' kg';rd();}
  function setM2(v){m2=+v;document.getElementById('l7m2').textContent=(+v).toFixed(1)+' kg';rd();}
  function setV1(v){v1i=+v;document.getElementById('l7v1').textContent=(+v).toFixed(1)+' m/s';rd();}
  function setV2(v){v2i=+v;document.getElementById('l7v2').textContent=(+v).toFixed(1)+' m/s';rd();}
  function setE(v){e=+v;document.getElementById('l7e').textContent=(+v).toFixed(2);rd();}
  function pp(){if(!run){RC(cv);initPos();}run=!run;document.getElementById('b7pp').innerHTML=run?'‚è∏ Pauza':'‚ñ∂ Start';if(run){last=null;raf=requestAnimationFrame(loop);}else cancelAnimationFrame(raf);}
  function reset(){run=false;cancelAnimationFrame(raf);document.getElementById('b7pp').innerHTML='‚ñ∂ Start';RC(cv);initPos();draw();rd();}
  function collide(){
    const v1f=((m1-e*m2)*v1+(1+e)*m2*v2)/(m1+m2);
    const v2f=((m2-e*m1)*v2+(1+e)*m1*v1)/(m1+m2);
    v1=v1f;v2=v2f;collided=true;
    // flash
    ctx.save();ctx.fillStyle='rgba(255,255,255,.25)';ctx.fillRect(0,0,cv.width,cv.height);ctx.restore();
  }
  function loop(ts){
    if(!run)return;if(!last)last=ts;const dt=Math.min((ts-last)/1000,.04);last=ts;
    const sc=35;x1+=v1*dt*sc;x2+=v2*dt*sc;
    // collision detection
    if(!collided&&x1+r1()>=x2-r2()){x1=x2-r1()-r2();collide();}
    // wall bounce
    if(x1-r1()<0){x1=r1();v1=Math.abs(v1)*e;}
    if(x2+r2()>cv.width){x2=cv.width-r2();v2=-Math.abs(v2)*e;}
    if(x1+r1()>x2-r2()&&collided){x1=x2-r1()-r2();}// prevent overlap
    draw();raf=requestAnimationFrame(loop);
  }
  function rd(){
    const p1=m1*v1i,p2=m2*v2i,pt=p1+p2,Ek=.5*m1*v1i*v1i+.5*m2*v2i*v2i;
    document.getElementById('r7p1').textContent=p1.toFixed(1)+' kg¬∑m/s';
    document.getElementById('r7p2').textContent=p2.toFixed(1)+' kg¬∑m/s';
    document.getElementById('r7pt').textContent=pt.toFixed(1)+' kg¬∑m/s';
    document.getElementById('r7ek').textContent=Ek.toFixed(1)+' J';
    const typ=e>=.99?'ELASTYCZNE':e<=.01?'IDEALNIE NIEELASTYCZNE':'CZƒò≈öCIOWO ELASTYCZNE';
    document.getElementById('r7ty').textContent=typ;
    document.getElementById('r7ty').style.color=e>=.99?'#34d399':e<=.01?'#f87171':'#fbbf24';
  }
  function draw(){
    RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
    if(!run&&phase===0){RC(cv);x1=W*0.22;x2=W*0.75;v1=v1i;v2=v2i;}
    const gY=H*.58;
    GROUND(ctx,gY,W);
    // momentum arrows under ground
    const p1=m1*(run?v1:v1i),p2=m2*(run?v2:v2i);
    const psc=W*.0055;
    if(Math.abs(p1)>.1){ARW(ctx,x1,gY+24,x1+p1*psc,gY+24,'#f87171aa',2);TXT(ctx,'p‚ÇÅ='+p1.toFixed(1),x1+p1*psc/2,gY+36,'#f87171',8,true);}
    if(Math.abs(p2)>.1){ARW(ctx,x2,gY+24,x2+p2*psc,gY+24,'#60a5faaa',2);TXT(ctx,'p‚ÇÇ='+p2.toFixed(1),x2+p2*psc/2,gY+36,'#60a5fa',8,true);}

    // ball 1
    const R1=r1(),R2=r2();
    const g1=ctx.createRadialGradient(x1-R1*.3,gY-R1*1.6-R1*.3,1,x1,gY-R1*1.6,R1);
    g1.addColorStop(0,'#fca5a5');g1.addColorStop(1,'#f87171');
    ctx.save();ctx.shadowColor='#f8717188';ctx.shadowBlur=14;
    ctx.beginPath();ctx.arc(x1,gY-R1*1.6,R1,0,Math.PI*2);ctx.fillStyle=g1;ctx.fill();ctx.strokeStyle='#f87171';ctx.lineWidth=2;ctx.stroke();ctx.shadowBlur=0;ctx.restore();
    TXT(ctx,'m‚ÇÅ',x1,gY-R1*1.6+4,'#fff',9,true);TXT(ctx,m1.toFixed(1)+' kg',x1,gY-R1*1.6-R1-8,'rgba(255,255,255,.3)',8,true);
    if(Math.abs(run?v1:v1i)>.05){const vsc=6,vv=run?v1:v1i;ARW(ctx,x1,gY-R1*1.6,x1+vv*vsc,gY-R1*1.6,'#fbbf24',2.5);TXT(ctx,'v='+vv.toFixed(1),x1+vv*vsc/2,gY-R1*1.6-R1-22,'#fbbf24',8,true);}

    // ball 2
    const g2=ctx.createRadialGradient(x2-R2*.3,gY-R2*1.6-R2*.3,1,x2,gY-R2*1.6,R2);
    g2.addColorStop(0,'#93c5fd');g2.addColorStop(1,'#3b82f6');
    ctx.save();ctx.shadowColor='#60a5fa88';ctx.shadowBlur=14;
    ctx.beginPath();ctx.arc(x2,gY-R2*1.6,R2,0,Math.PI*2);ctx.fillStyle=g2;ctx.fill();ctx.strokeStyle='#60a5fa';ctx.lineWidth=2;ctx.stroke();ctx.shadowBlur=0;ctx.restore();
    TXT(ctx,'m‚ÇÇ',x2,gY-R2*1.6+4,'#fff',9,true);TXT(ctx,m2.toFixed(1)+' kg',x2,gY-R2*1.6-R2-8,'rgba(255,255,255,.3)',8,true);
    if(Math.abs(run?v2:v2i)>.05){const vsc=6,vv=run?v2:v2i;ARW(ctx,x2,gY-R2*1.6,x2+vv*vsc,gY-R2*1.6,'#fbbf24',2.5);TXT(ctx,'v='+vv.toFixed(1),x2+vv*vsc/2,gY-R2*1.6-R2-22,'#fbbf24',8,true);}

    // conservation panel top-right
    const pt=(m1*v1i+m2*v2i).toFixed(1);
    RR(ctx,W-160,8,152,52,8,'rgba(4,3,10,.8)','rgba(99,102,241,.3)',1);
    TXT(ctx,'p_przed = '+pt+' kg¬∑m/s',W-84,24,'rgba(255,255,255,.5)',8,true);
    if(collided){
      const pt2=(m1*v1+m2*v2).toFixed(1);
      TXT(ctx,'p_po = '+pt2+' kg¬∑m/s',W-84,38,'#34d399',8,true);
      TXT(ctx,'‚úì zachowany',W-84,50,'#34d399aa',7,true);
    }

    // e label
    TXT(ctx,'e = '+e.toFixed(2),W/2,H*.84,e>=.99?'#34d399':e<=.01?'#f87171':'#fbbf24',11,true);
  }
  return{setM1,setM2,setV1,setV2,setE,pp,reset,rd,draw};
})();

// ‚îÄ‚îÄ S8: PROJECTILE ‚îÄ‚îÄ
const PR8=(()=>{
  const cv=document.getElementById('c8'),ctx=cv.getContext('2d');
  let v0=30,angDeg=45,g=9.81,showVec=true,showCmp=false;
  let px=0,py=0,vx=0,vy=0,t=0,run=false,raf=null,last=null,landed=false;
  let trail=[],cmpTrail=[],maxH=0,maxX=0,peakY=0;

  function setV0(v){v0=+v;document.getElementById('l8v0').textContent=v+' m/s';if(!run)reset();}
  function setA(v){angDeg=+v;document.getElementById('l8a').textContent=v+'¬∞';if(!run)reset();}
  function setG(v){g=+v;document.getElementById('l8g').textContent=(+v).toFixed(2)+' m/s¬≤';if(!run)reset();}
  function toggleCompare(){showCmp=document.getElementById('t8cmp').checked;if(!run)draw();}
  function pp(){
    if(landed)reset();
    run=!run;document.getElementById('b8pp').innerHTML=run?'‚è∏ Pauza':'‚ñ∂ Start';
    if(run){last=null;raf=requestAnimationFrame(loop);}else cancelAnimationFrame(raf);
  }
  function reset(){run=false;landed=false;trail=[];cmpTrail=[];maxH=0;maxX=0;peakY=0;
    const ang=angDeg*Math.PI/180;px=0;py=0;vx=v0*Math.cos(ang);vy=v0*Math.sin(ang);t=0;
    cancelAnimationFrame(raf);document.getElementById('b8pp').innerHTML='‚ñ∂ Start';draw();rd();}
  function rd(){
    document.getElementById('r8t').textContent=t.toFixed(2)+' s';
    document.getElementById('r8x').textContent=px.toFixed(1)+' m';
    document.getElementById('r8h').textContent=maxH.toFixed(1)+' m';
    document.getElementById('r8vx').textContent=vx.toFixed(1)+' m/s';
    document.getElementById('r8vy').textContent=vy.toFixed(1)+' m/s';
  }
  function loop(ts){
    if(!run)return;if(!last)last=ts;const dt=Math.min((ts-last)/1000,.025);last=ts;
    vy-=g*dt;px+=vx*dt;py+=vy*dt;t+=dt;
    if(py>maxH)maxH=py;
    trail.push([px,py]);
    if(py<=0&&t>.1){landed=true;maxX=px;run=false;document.getElementById('b8pp').innerHTML='‚ñ∂ Start';cancelAnimationFrame(raf);}
    draw();rd();if(run)raf=requestAnimationFrame(loop);
  }
  function worldToScreen(wx,wy,W,H,sc){
    const gY=H*.75,ox=W*.08;
    return[ox+wx*sc,gY-wy*sc];
  }
  function draw(){
    RC(cv);const W=cv.width,H=cv.height;ctx.clearRect(0,0,W,H);
    const gY=H*.75,ox=W*.08;
    const totalTime=2*v0*Math.sin(angDeg*Math.PI/180)/g;
    const totalRange=v0*v0*Math.sin(2*angDeg*Math.PI/180)/g;
    const peakH=v0*v0*Math.pow(Math.sin(angDeg*Math.PI/180),2)/(2*g);
    const sc=Math.min((W*.85)/Math.max(totalRange,.1),(H*.6)/Math.max(peakH,.1));
    GROUND(ctx,gY,W);

    // compare arcs at 30¬∞ and 60¬∞
    if(showCmp){
      [30,60].forEach(cmpAng=>{
        if(Math.abs(cmpAng-angDeg)<3)return;
        const ca=cmpAng*Math.PI/180,cvx=v0*Math.cos(ca),cvy=v0*Math.sin(ca);
        const cT=2*v0*Math.sin(ca)/g,steps=80;
        ctx.save();ctx.strokeStyle='rgba(255,255,255,.1)';ctx.lineWidth=1;ctx.setLineDash([4,6]);ctx.beginPath();
        for(let i=0;i<=steps;i++){const tt=cT*i/steps,cx2=ox+cvx*tt*sc,cy2=gY-(cvy*tt-.5*g*tt*tt)*sc;i===0?ctx.moveTo(cx2,cy2):ctx.lineTo(cx2,cy2);}
        ctx.stroke();ctx.setLineDash([]);
        TXT(ctx,cmpAng+'¬∞',ox+cvx*cT*sc,gY+14,'rgba(255,255,255,.2)',8,true);
        ctx.restore();
      });
    }

    // ideal parabola (dashed)
    ctx.save();ctx.strokeStyle='rgba(167,139,250,.18)';ctx.lineWidth=1.2;ctx.setLineDash([5,7]);ctx.beginPath();
    const ang=angDeg*Math.PI/180,cvx2=v0*Math.cos(ang),cvy2=v0*Math.sin(ang),totT=totalTime,steps2=80;
    for(let i=0;i<=steps2;i++){const tt=totT*i/steps2,cx2=ox+cvx2*tt*sc,cy2=gY-(cvy2*tt-.5*g*tt*tt)*sc;i===0?ctx.moveTo(cx2,cy2):ctx.lineTo(cx2,cy2);}
    ctx.stroke();ctx.setLineDash([]);ctx.restore();

    // trail glow
    if(trail.length>1){
      ctx.save();ctx.shadowColor='#fbbf24';ctx.shadowBlur=6;
      ctx.strokeStyle='#fbbf24';ctx.lineWidth=2.5;ctx.beginPath();
      trail.forEach(([wx,wy],i)=>{const[sx,sy]=worldToScreen(wx,wy,W,H,sc);i===0?ctx.moveTo(sx,sy):ctx.lineTo(sx,sy);});
      ctx.stroke();ctx.shadowBlur=0;ctx.restore();
    }

    // projectile (current pos)
    const[bsx,bsy]=worldToScreen(px,py,W,H,sc);
    ctx.save();ctx.shadowColor='#fbbf24';ctx.shadowBlur=16;
    const bR=10;const bg2=ctx.createRadialGradient(bsx-3,bsy-3,1,bsx,bsy,bR);
    bg2.addColorStop(0,'#fde68a');bg2.addColorStop(1,'#f59e0b');
    ctx.beginPath();ctx.arc(bsx,bsy,bR,0,Math.PI*2);ctx.fillStyle=bg2;ctx.fill();ctx.strokeStyle='#fbbf24';ctx.lineWidth=2;ctx.stroke();ctx.shadowBlur=0;ctx.restore();

    // velocity vectors
    if(document.getElementById('t8vec').checked&&!landed){
      const vsc=3;
      ARW(ctx,bsx,bsy,bsx+vx*vsc,bsy,'#a78bfa',2.5,8);
      ARW(ctx,bsx,bsy,bsx,bsy-vy*vsc,'#f87171',2.5,8);
      ARW(ctx,bsx,bsy,bsx+vx*vsc,bsy-vy*vsc,'#34d399',2,8);
      TXT(ctx,'Vx',bsx+vx*vsc+8,bsy,'#a78bfa',8,false,'left');
      TXT(ctx,'Vy',bsx+6,bsy-vy*vsc,'#f87171',8,false,'left');
    }

    // peak marker
    const[psx,psy]=worldToScreen(0,peakH,W,H,sc);
    const[psx2]=worldToScreen(v0*Math.cos(ang)*v0*Math.sin(ang)/g,peakH,W,H,sc);
    ctx.save();ctx.strokeStyle='rgba(244,114,182,.3)';ctx.lineWidth=1;ctx.setLineDash([4,5]);
    ctx.beginPath();ctx.moveTo(ox,psy);ctx.lineTo(psx2,psy);ctx.stroke();ctx.setLineDash([]);ctx.restore();
    TXT(ctx,'H='+peakH.toFixed(1)+'m',ox-6,psy,'rgba(244,114,182,.5)',8,true,'right');

    // range marker
    const[rsx]=worldToScreen(totalRange,0,W,H,sc);
    ctx.save();ctx.strokeStyle='rgba(52,211,153,.3)';ctx.lineWidth=1;ctx.setLineDash([4,5]);
    ctx.beginPath();ctx.moveTo(rsx,gY);ctx.lineTo(rsx,gY-16);ctx.stroke();ctx.setLineDash([]);ctx.restore();
    TXT(ctx,'R='+totalRange.toFixed(1)+'m',rsx,gY+14,'rgba(52,211,153,.5)',8,true);

    // launch angle visual
    const arrowLen=48;
    ARW(ctx,ox,gY,ox+Math.cos(ang)*arrowLen,gY-Math.sin(ang)*arrowLen,'#34d399',2.5,8);
    ctx.save();ctx.strokeStyle='rgba(52,211,153,.3)';ctx.lineWidth=1;
    ctx.beginPath();ctx.arc(ox,gY,22,0,-ang,true);ctx.stroke();ctx.restore();
    TXT(ctx,angDeg+'¬∞',ox+28,gY-10,'rgba(52,211,153,.6)',9,true);

    // formula box
    const fX=W*.65,fY=H*.08;
    RR(ctx,fX,fY,W*.3,70,8,'rgba(4,3,10,.85)','rgba(99,102,241,.3)',1);
    TXT(ctx,'R = v‚ÇÄ¬≤¬∑sin(2Œ∏)/g',fX+W*.15,fY+16,'rgba(255,255,255,.4)',9,true);
    TXT(ctx,'H = v‚ÇÄ¬≤¬∑sin¬≤(Œ∏)/(2g)',fX+W*.15,fY+30,'rgba(255,255,255,.4)',9,true);
    TXT(ctx,'R = '+totalRange.toFixed(1)+' m',fX+W*.15,fY+46,'#34d399',9,true,);
    TXT(ctx,'H = '+peakH.toFixed(1)+' m',fX+W*.15,fY+60,'#f472b6',9,true);

    rd();
  }
  return{setV0,setA,setG,toggleCompare,pp,reset};
})();

// ‚îÄ‚îÄ TAB SWITCH ‚îÄ‚îÄ
let curTab=0;
function showTab(i){
  document.querySelectorAll('.sc').forEach((s,j)=>s.classList.toggle('active',j===i));
  document.querySelectorAll('.tb').forEach((b,j)=>b.classList.toggle('active',j===i));
  curTab=i;
  setTimeout(()=>{
    [T1,M2.e,M3.e,M4.e,P5,SP6,CL7,PR8][i]?.draw?.();
    if(i===1)M2.e.draw();if(i===6)CL7.draw();if(i===7)PR8.draw();
  },30);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
function init(){
  M2.buildUI();M3.buildUI();
  T1.rd();T1.draw();
  CL7.rd();CL7.draw();
  PR8.draw();
  SP6.reset();
  setTimeout(()=>{
    document.querySelectorAll('.sc').forEach((_,i)=>{if(i>0){showTab(i);setTimeout(()=>{showTab(0);},10);}});
    showTab(0);
    document.querySelectorAll('input[type=range]').forEach(UF);
  },100);
}
const RO=new ResizeObserver(()=>{
  const draws=[T1.draw,M2.e.draw,M3.e.draw,M4.e.draw,()=>P5.reset&&null,()=>SP6.reset&&null,CL7.draw,PR8.draw];
  draws[curTab]?.();
});
['w1','w2','w3','w4','w5','w6','w7','w8'].forEach(id=>{const el=document.getElementById(id);if(el)RO.observe(el);});
init();
</script>
</body>
</html>